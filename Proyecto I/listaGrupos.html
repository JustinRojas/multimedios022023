<!DOCTYPE html>
<html lang="en">

<head>
  <title>Listar Datos</title>
  <!-- Required meta tags -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

  <!-- Bootstrap CSS v5.2.1 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-iYQeCzEYFbKjA/T2uDLTpkwGzCiq6soy8tYaI1GyVh/UjpbCx/TYkiZhlZB6+fzT" crossorigin="anonymous" />
</head>

<body>
  <div class="container">
    <header id="headerplace">
      <!-- place navbar here -->

    </header>
    <main>

      <div class="container">
        <div class="row">
          <div class="col align-self-start">

            <blockquote class="blockquote">
              <p>Welcome to groups view</p>
            </blockquote>
          </div>
          <div class="col align-self-center">

          </div>
          <div class="col align-self-end ">
            <!-- Botón que para crear curso -->
            <button type="button" onClick="crearGrupo()" class="btn btn-primary btn-md mt-4 mb-4 "
              data-bs-toggle="modal" data-bs-target="#modalId">
              Crear un nuevo grupo
            </button>
          </div>
        </div>
      </div>



      <div class="table-responsive">
        <table class="table table-striped table-hover table-borderless table-success align-middle">
          <thead class="table-light">
            <caption>
              Table Name
            </caption>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="resultados" class="table-group-divider"></tbody>
          <tfoot></tfoot>
        </table>
      </div>
    </main>


    <!-- MODAL DE CREAR Y EDITAR -->
    <div class="modal fade" id="modalId" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" role="dialog"
      aria-labelledby="modalTitleId" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitleId">Modal title</h5>
            <button type="button" onClick="cerrarModal()" class="btn-close" data-bs-dismiss="modal"
              aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="formulario" action="">

              <div id="div-id" class="mb-3">


              </div>

              <div class="mb-3">
                <label for="" class="form-label">Nombre</label>
                <input type="text" name="" id="nombre" required class="form-control"
                  placeholder="ingresar nombre del curso" aria-describedby="helpId">
                <small id="helpId" class="text-muted">Campo requerido</small>
              </div>


              <div class="mb-3">
                <button type="reset" id="cancel-rest" class="btn btn-danger">Cancelar</button>
                <button type="submit" id="" class="btn btn-primary">Guardar</button>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

          </div>
        </div>
      </div>
    </div>


    <!-- MODAL DE DETALLES -->
    <div class="modal fade" id="modalDetalles" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
      role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
      <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="tite">Detalles estudiante</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">

            <form id="formDetalles" action="">
              <div class="mb-3">
                <label for="" class="form-label">Id</label>
                <input type="text" name="" id="idEs" readonly style="background-color: rgb(184, 184, 184);" required
                  class="form-control" placeholder="ingresar nombre del curso" aria-describedby="helpId">

              </div>
              <div class="mb-3">
                <label for="" class="form-label">Nombre</label>
                <input type="text" name="" id="nombreEs" readonly required class="form-control"
                  placeholder="ingresar nombre del curso" aria-describedby="helpId">

              </div>

            </form>

          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>

          </div>
        </div>
      </div>
    </div>


    <footer id="footerPages" class="text-muted py-5">
      <!-- place footer here -->



      <div class="modal fade" id="modalEliminar" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
        role="dialog" aria-labelledby="modalTitleId" aria-hidden="true">
        <div class="modal-dialog modal-dialog-scrollable modal-dialog-centered modal-sm" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="modalTitleId">Modal eliminar</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div id="modalcontent">

              </div>
              <form id="formConfirmacion" action="">
                <button type="reset" class="btn btn-danger" data-bs-dismiss="modal">Eliminar</button>
                <button type="submit" class="btn btn-primary">Cancelar</button>
              </form>

            </div>
            <div class="modal-footer">

            </div>
          </div>
        </div>
      </div>

    </footer>
  </div>


  <script src="menu.js"> </script>

  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"
    integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3"
    crossorigin="anonymous"></script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js"
    integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz"
    crossorigin="anonymous"></script>



  <script>


    // INICIO BLOQUE DE DETALLLES

    const modalDetails = new bootstrap.Modal(document.getElementById('modalDetalles'));

        function detalles(id, nombre) {

            document.getElementById('idEs').value = id;
            document.getElementById('nombreEs').value = nombre;
           
        };
    // FIN BLOQUE DE DETALLLES

    // INICIO BLOQUE DE EDITAR

    const myModal = new bootstrap.Modal(document.getElementById('modalId'));
    //nuestra referencia al modal

    function cerrarModal() {
      myModal.hide();

    }
    function cargarModal(id, nombre) {
      myModal.show();
      divId.innerHTML = `<label  class="form-label"> Id</label>
                                <input type="text" style="background-color: rgb(189, 187, 187);"   value="${id}" readonly required class="form-control"
                                    placeholder="" aria-describedby="helpId">`;
      document.getElementById('nombre').value = nombre;

      actualizarGrupo(id);

    }

    function actualizarGrupo(id) {

      formulario.addEventListener('submit', function (e) {
        e.preventDefault();

        var nombre = document.getElementById('nombre').value;



        var datosenviar = {
          id: `${id}`,  //se agregó este id
          nombre: `${nombre}`

        }

        fetch("https://paginas-web-cr.com/ApiPHP/apis/ActualizarGrupo.php",
          {
            method: 'POST', //por que es el método que se usa para insertar
            body: JSON.stringify(datosenviar)
          }
        ).then((respuesta) => respuesta.json().ok)             //recibe los datos em formato json
          .then((datosrespuesta) => {
            console.log('Datos, datosrespuesta');
            alert('Los datos se guardaron correctamente');
            window.location.href = "./listaGrupos.html";


          })
          .catch(error => console.error('Error:', error))
          .then(response => console.log('Success:', response));

      });

    };

    // FIN BLOQUE DE EDITAR

    //INICIO DE BLOQUE ELIMINIAR 

    const mdDelete = new bootstrap.Modal(document.getElementById('modalEliminar'));

    var formConfirmacion = document.getElementById('formConfirmacion');
    var modalcontent = document.getElementById('modalcontent');
    function eliminar(id, nombre) {
      confirmarEliminacion(id, nombre);

    };

    function confirmarEliminacion(id, nombre) {
      mdDelete.show();
      modalcontent.innerHTML = `<h6 > Desea eliminar el grupo ${nombre} con id ${id} </h6>`;

      formConfirmacion.addEventListener('reset', function (e) {
        e.preventDefault();


        datosenviar = {
          id: `${id}`
        }

        fetch("https://paginas-web-cr.com/ApiPHP/apis/BorrarGrupo.php",
          {
            method: 'POST', //por que es el método que se usa para insertar
            body: JSON.stringify(datosenviar)
          }
        ).then((respuesta) => respuesta.json().ok)             //recibe los datos em formato json
          .then((datosrespuesta) => {
            console.log('Datos, datosrespuesta');
            window.location.href = "./listaGrupos.html";
            alert(`El grupo con id ${id} se borró correctamente`);
            alerta('El grupo con id ${id} se borró correctamente', 'success');

          })
          .catch(error => console.error('Error:', error))
          .then(response => console.log('Success:', response));

      });

      formConfirmacion.addEventListener('submit', function (e) {
        alert('Cancelando...');
        mdDelete.hide();
        e.preventDefault();
      });
    }



    //FIN DE BLOQUE ELIMINIAR 


    //  INICIO BLOQUE CREAR GRUPO
    var divId = document.getElementById('div-id');
    function limpiarCampos() {

      divId.innerHTML = "";
      document.getElementById('nombre').value = "";

    };
    function crearGrupo() {
      limpiarCampos();
      formulario.addEventListener('submit', function (e) {
        e.preventDefault();
        var nombre = document.getElementById('nombre').value;

        var datosenviar = {

          nombre: `${nombre}`

        }

        fetch("https://paginas-web-cr.com/ApiPHP/apis/InsertarGrupo.php",
          {
            method: 'POST', //por que es el método que se usa para insertar
            body: JSON.stringify(datosenviar)
          }
        ).then((respuesta) => respuesta.json().ok)             //recibe los datos em formato json
          .then((datosrespuesta) => {
            console.log('Datos, datosrespuesta');
            alert('Los datos se guardaron correctamente');
            window.location.href = "./listaGrupos.html";
          })
          .catch(error => console.error('Error:', error))
          .then(response => console.log('Success:', response));

      });



    };


    //  FIN BLOQUE CREAR GRUPO


    //declaracion de variabe
    var contenidoTablaResultado = document.querySelector("#resultados");

    function cargarDatos() {
      fetch("https://paginas-web-cr.com/ApiPHP/apis/ListaGrupo.php")
        .then((respuesta) => respuesta.json()) //recibe los datos em formato json
        .then((datosrespuesta) => {
          setTable(datosrespuesta.data); //lo envio a la funcion de abajo
          // console.log('Datos', datosrespuesta.data);
        })
        .catch(console.log);
    }

    function setTable(datos) {
      console.log("Datos", datos);

      for (const valor of datos) {
        console.log("valor", valor);
        contenidoTablaResultado.innerHTML += `
          <tr  class="table-primary">
            <td class="col-md-4" scope="row">${valor.id}</td>
            <td class="col-md-4">${valor.nombre}</td>

            <td class="col-md-4"> 
                  <button type="button" onClick="eliminar('${valor.id}', '${valor.nombre}')" class=" mb-1 btn-sm btn btn-danger data-bs-toggle="modal" data-bs-target="#modalEliminar">
                     Eliminar
                  </button>
                  ||
                  <button type="button" onClick="cargarModal('${valor.id}','${valor.nombre}')" class="  mb-1 btn-sm btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalId">
                    Editar
                  </button>
                  ||
                  <button type="button" onClick="detalles('${valor.id}','${valor.nombre}')" class="  mb-1 btn-sm btn btn-info" data-bs-toggle="modal" data-bs-target="#modalDetalles">
                   Detalles
                  </button>

              </td>
          </tr>`;
      }
    }
    cargarDatos();
  </script>
</body>

</html>